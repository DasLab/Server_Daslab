{% extends "admin/base.html" %}
{% load i18n admin_static %}

{% block title %}Das Lab Website Administration{% endblock %}
{% block bodyclass %}dashboard{% endblock %}

{% block content %}
  <div id="content-main" class="col-md-12">
    <div class="row">
      <div class="col-md-12">
        <div class="row">
          <div class="col-md-8">
            <h4 class="italic-title"><span class="glyphicon glyphicon-hdd"></span> {% trans 'Directory Status' %}</h4>
          </div>
          <div class="col-md-4">
            <a href="/admin/backup_stat" class="btn btn-warning pull-right"><span class="glyphicon glyphicon-refresh"></span>&nbsp;&nbsp;Refresh</a>            
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <table class="table">
          <thead>
            <tr class="active">
              <th class="col-md-6"></th>
              <th class="col-md-3"><span class="glyphicon glyphicon-th"></span> # of Files</th>
              <th class="col-md-3"><span class="glyphicon glyphicon-share"></span> Size</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="glyphicon glyphicon-picture"></span> News Items</td><td id="id_news_n"></td><td id="id_news_s"></td>
            </tr>
            <tr>
              <td><span class="glyphicon glyphicon-user"></span> Members</td><td id="id_member_n"></td><td id="id_member_s"></td>
            </tr>
            <tr>
              <td><span class="glyphicon glyphicon-file"></span> Publication PDFs</td><td id="id_pub_n"></td><td id="id_pub_s"></td>
            </tr>
            <tr>
              <td><span class="glyphicon glyphicon-retweet"></span> Rotation Students</td><td id="id_rot_n"></td><td id="id_rot_s"></td>
            </tr>
            <tr>
              <td><span class="glyphicon glyphicon-cd"></span> Archived Presentations</td><td id="id_spe_n"></td><td id="id_spe_s"></td>
            </tr>
            <tr><td colspan="3" style="padding: 0px;"></td></tr>
          </tbody>
        </table>

        <h4 class="italic-title"><span class="glyphicon glyphicon-hdd"></span> {% trans 'Local Backup' %}</h4>
        <table class="table">
          <thead>
            <tr class="active">
              <th class="col-md-9"><span class="glyphicon glyphicon-file"></span> File</th>
              <th class="col-md-3"><span class="glyphicon glyphicon-share"></span> Size</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td id="id_mysql_p"><span class="glyphicon glyphicon-oil"></span> MySQL Database</td><td id="id_mysql_s"></td>
            </tr>
            <tr>
              <td id="id_static_p"><span class="glyphicon glyphicon-adjust"></span> Static Files</td><td id="id_static_s"></td>
            </tr>
            <tr>
              <td id="id_apache_p"><span class="glyphicon glyphicon-grain"></span> Apache Setting</td><td id="id_apache_s"></td>
            </tr>
            <tr><td colspan="2" style="padding: 0px;"></td></tr>
          </tbody>
        </table>

        <h4 class="italic-title">
          <span class="glyphicon glyphicon-cloud"></span> {% trans 'Google Drive' %}
          <span class="pull-right">
            <a href="http://drive.google.com" target="_blank" class="btn btn-warning">
              <span class="glyphicon glyphicon-inbox"></span>&nbsp;&nbsp;Google Drive
            </a>
          </span>
        </h4>
        <p>The <u>{{email}}</u> account is used for sync.</p>
        <table class="table">
          <thead>
            <tr class="active">
              <th class="col-md-6"><span class="glyphicon glyphicon-file"></span> File</th>
              <th class="col-md-4"><span class="glyphicon glyphicon-time"></span> Time</th>
              <th class="col-md-2"><span class="glyphicon glyphicon-share"></span> Size</th>
            </tr>
          </thead>
          <tbody id="gdrive_list"></tbody>
        </table>
      </div>

      <div class="col-md-6">
        <br/>
        <h4 class="italic-title"><span class="glyphicon glyphicon-wrench"></span> {% trans 'Settings' %}</h4>
        <div class="thumbnail" style="margin-bottom:0px;">
          <form enctype="multipart/form-data" action="/admin/backup/" method="post">
            {% csrf_token %}
            <div class="form-group" style="padding:10px;margin-bottom:0px;">
              <div class="well" style="margin-bottom:0px;">
                <div class="alert alert-success" id="banner_backup">
                  <label>
                    <span class="glyphicon glyphicon-ok-sign" id="sign_backup"></span>&nbsp;&nbsp;&nbsp;&nbsp;
                    <span class="glyphicon glyphicon-floppy-saved"></span> Weekly Backup
                  </label>
                </div>
                <div class="row">
                  <div class="col-md-2">
                      <label for="username" class="pull-right">
                        <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                        &nbsp;&nbsp;On:
                      </label>
                  </div>
                  <div class="col-md-4">
                     {{form.time_backup}}
                  </div>
                  <div class="col-md-2">
                      <label for="username" class="pull-right">
                        &nbsp;&nbsp;Every:
                      </label>
                  </div>
                  <div class="col-md-3">
                     {{form.day_backup}}
                  </div>
                  <div class="col-md-1"></div>
                </div>  
                <br/>
                <div class="row">
                  <div class="col-md-1"></div>
                  <div class="col-md-10">
                    <b>Note</b>: Time above is in <abbr title="">UTC</abbr>. Equivalent to:
                    <br/>
                    <span id="time_backup_pdt" class="label label-primary"></span>, <span id="day_backup_pdt" class="label label-inverse"></span> (PDT)
                  </div>
                  <div class="col-md-1"></div>
                </div>
              </div>
            </div>
            <div class="form-group" style="padding:10px;margin-bottom:0px;">
              <div class="well" style="margin-bottom:0px;">
                <div class="alert alert-success" id="banner_sync">
                  <label>
                    <span class="glyphicon glyphicon-ok-sign" id="sign_sync"></span>&nbsp;&nbsp;&nbsp;&nbsp;
                    <span class="glyphicon glyphicon-floppy-open"></span> Sync to Google Drive
                  </label>
                </div>
                <div class="row">
                  <div class="col-md-2">
                      <label for="username" class="pull-right">
                        <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                        &nbsp;&nbsp;On:
                      </label>
                  </div>
                  <div class="col-md-4">
                     {{form.time_upload}}
                  </div>
                  <div class="col-md-2">
                      <label for="username" class="pull-right">
                        &nbsp;&nbsp;Every:
                      </label>
                  </div>
                  <div class="col-md-3">
                     {{form.day_upload}}
                  </div>
                  <div class="col-md-1"></div>
                </div>  
                <br/>
                <div class="row">
                  <div class="col-md-1"></div>
                  <div class="col-md-10">
                    <b>Note</b>: Time above is in <abbr title="">UTC</abbr>. Equivalent to:
                    <br/>
                    <span id="time_upload_pdt" class="label label-primary"></span>, <span id="day_upload_pdt" class="label label-inverse"></span> (PDT)
                  </div>
                  <div class="col-md-1"></div>
                </div>
                <br/>
                <div class="row">
                  <div class="col-md-1"></div>
                  <div class="col-md-5">
                      <label for="username" class="pull-right">
                        <span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span>
                        &nbsp;&nbsp;Keep on Google Drive:
                      </label>
                  </div>
                  <div class="col-md-3">
                     {{form.keep}}
                  </div>
                  <div class="col-md-2"> Days.</div>
                </div>

              </div>
            </div>
            <div class="row">
              <span class="pull-right">
                <button type="submit" class="btn btn-info"/><span class="glyphicon glyphicon-ok-circle"></span>&nbsp;&nbsp;Save</button>
                &nbsp;&nbsp;
                <button type="button" class="btn btn-default" onclick="location.href='/admin/backup'"><span class="glyphicon glyphicon-ban-circle"></span>&nbsp;&nbsp;Reset</button>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              </span>
            </div>
            <br/>

          </form>
        </div>

        <br/>
        <div class="well">
          <div class="row">
            <div class="col-md-1"></div>
            <div class="col-md-4">
              <p><b>Note</b>: This may take 1-2 minutes to complete.</p>
            </div>
            <div class="col-md-7">
              <span class="pull-right">
                <a href="/admin/backup_now" class="btn btn-danger"/><span class="glyphicon glyphicon-floppy-saved"></span>&nbsp;&nbsp;Backup Now</a>
                &nbsp;&nbsp;
                <a href="/admin/upload_now" class="btn btn-blue"><span class="glyphicon glyphicon-floppy-open"></span>&nbsp;&nbsp;Upload Now</a>
              </span>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>

  <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modalStat" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content panel-success">
        <div class="modal-header panel-heading">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="stat_label">
            <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
              &nbsp;&nbsp;Change of Settings
          </h4>
        </div>
        <div class="modal-body panel-body">
          <h2><span class="label label-danger">NEW SETTINGS APPLIED</span></h2>
          <br/>
          <div class="col-md-12">
            <table class="table">
              <tbody>
                <tr>
                  <td><span class="glyphicon glyphicon-floppy-saved"></span> Weekly Backup</td>
                  <td id="modal_backup"></td>
                </tr>
                <tr>
                  <td><span class="glyphicon glyphicon-floppy-open"></span> Sync to Google Drive</td>
                  <td id="modal_upload"></td>
                </tr>
                <tr>
                  <td></td>
                  <td id="modal_keep"></td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
    </div>


{% endblock %}


{% block extrajs %}
  <script type="text/javascript" src="/site_media/js/admin/backup.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $("ul.breadcrumb").append('<li class="active"><a href="/admin/backup/">Backup Schedule</a></li>');

      $("#id_keep").val({{keep}});
      $("#modal_keep").html('Keep <span class="label label-orange">' + $("#id_keep").val() + '</span> Days');

      if ({{flag}}) {$("#modal").modal("show");}
    });
  </script>
{% endblock %}

